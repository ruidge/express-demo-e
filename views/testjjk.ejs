<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <% include common/header.ejs %>
</head>
<body>
<% include common/navbar.ejs %>
<div>
    <h1>testjjk</h1>

    <h1><a href="http://www.mi.com">http://www.mi.com</a></h1>

    <h1><a href="JJK://IM">JJK://IM</a></h1>

    <h1><a href="JJK://PRODUCT">JJK://PRODUCT</a></h1>

    <h1><a href="JJK://PRODUCT/2">JJK://PRODUCT/2</a></h1>

    <h1><input type='checkbox' checked id='cbx'/> <a href="#">阅读须知</a></h1>

    <h3>用户token是: <span id="token"></span></h3>

    <h3>绑定流程id是: <span id="processid"></span></h3>

    <h3>flag是: <span id="flag"></span></h3>

    <button class="btn btn-info" id="to_genes_collect_guide">基因采集</button>
</div>

<% include common/footer.ejs %>
<script src="/js/ios.invoke.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
    $(document).ready(function () {
        if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {

            //callback hell
            window.external.invoke("getToken", {}, function (status, result) {

                window.external.invoke("getGenesProcessId", {}, function (status, result) {
                    if (status == 200) {
                        var processid = result.genesProcessId;
                        $('#processid').text(processid);
                    } else {
                        alert("get value error.");
                    }
                });
                if (status == 200) {
                    var token = result.token;
                    $('#token').text(token);
                } else {
                    alert("get value error.");
                }
            });


        } else if (/(Android)/i.test(navigator.userAgent)) {
            var params = window.jjk.getParams();
            $('#token').text(params.token);
            $('#processid').text(params.sid);
            $('#flag').text(params.iflag);
        }
    });
    $(document).ready(function () {
        $("#to_genes_collect_guide").on("click", function () {
            if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {
                window.external.invoke("toGenesCollectGuide", {}, function (status, result) {
                });
            } else if (/(Android)/i.test(navigator.userAgent)) {
                window.jjk.toGenesCollectGuide();
            }
        });
    });


    $(document).ready(function () {
        $("#cbx").change(function () {
            if (this.checked) {
//                window.jjk.setButtonEnable('buy_product', '1');
                if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {
                    window.external.invoke("setButtonEnable", {
                        "type": "buy_product",
                        "enable": "1"
                    }, function (status, result) {

                    });
                } else if (/(Android)/i.test(navigator.userAgent)) {
                    window.jjk.setButtonEnable('buy_product', '1');
                }

            } else {
//                window.jjk.setButtonEnable('buy_product', '0');
                if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {
                    window.external.invoke("setButtonEnable", {
                        "type": "buy_product",
                        "enable": "0"
                    }, function (status, result) {

                    });
                } else if (/(Android)/i.test(navigator.userAgent)) {
                    window.jjk.setButtonEnable('buy_product', '0');
                }

            }
        });
    });

</script>

</body>
</html>